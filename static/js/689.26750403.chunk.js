"use strict";(self.webpackChunkgraphwear=self.webpackChunkgraphwear||[]).push([[689],{5689:(e,t,a)=>{a.r(t),a.d(t,{default:()=>D});var s=a(5043),l=a(5472),r=a(791),n=a(522),i=a(579);const o=e=>{let{children:t,header:a=" ",onEdit:s,isDisable:l=!1,disableReason:r="Not Allowed"}=e;return(0,i.jsxs)("div",{className:"w-full bg-white px-4 md:px-8 rounded-xl",children:[a&&(0,i.jsxs)("div",{className:"flex items-end gap-[5px] mb-8",children:[(0,i.jsx)("h2",{className:"font-bold text-xl md:text-2xl",children:a}),s&&(0,i.jsx)("p",{className:"text-xl font-bold "+(l?"cursor-not-allowed text-gray-500":"cursor-pointer text-accent hover:text-amber-700 duration-100"),onClick:l?()=>{}:s,title:l?r:"",children:"(edit)"})]}),t]})};var c=a(3969),d=a(256),m=a(9067),x=a(8141),h=a(6196),u=a(9441),f=a(6185),p=a(6711),b=a(1725),j=a(5122),v=a(446),g=a.n(v),w=a(3216),N=a(9928);(0,N.A)({components:{MuiIconButton:{styleOverrides:{root:{"& .MuiSvgIcon-root":{color:"#ffffff !important"},"&:hover .MuiSvgIcon-root":{color:"#ffffff !important"},"&.Mui-active .MuiSvgIcon-root":{color:"#ffffff !important"}}}},MuiTableSortLabel:{styleOverrides:{root:{"& .MuiSvgIcon-root":{color:"#ffffff !important"},"&:hover .MuiSvgIcon-root":{color:"#ffffff !important"},"&.Mui-active .MuiSvgIcon-root":{color:"#ffffff !important"}}}}}}),(0,N.A)({components:{MuiIconButton:{styleOverrides:{root:{"& .MuiSvgIcon-root":{color:"#707070 !important"}}}},MuiTableSortLabel:{styleOverrides:{root:{"& .MuiSvgIcon-root":{color:"#707070 !important"},"&:hover .MuiSvgIcon-root":{color:"#ffffff !important"},"&.Mui-active .MuiSvgIcon-root":{color:"#707070 !important"}}}}}});const S=function(e,t){let a=arguments.length>2&&void 0!==arguments[2]?arguments[2]:null,s=arguments.length>3&&void 0!==arguments[3]?arguments[3]:null;if(!t.length)return;const l=a?new Date(a).getTime():null,r=s?new Date(s).getTime():null,n=t.filter((e=>{const t=new Date(e.timestamp).getTime();return(!l||t>=l)&&(!r||t<=r)}));if(!n.length)return;const i=Object.keys(n[0]),o=n.map((e=>i.map((t=>{var a;return JSON.stringify(null!==(a=e[t])&&void 0!==a?a:"")})))),c=[i,...o].map((e=>e.join(","))).join("\n"),d=new Blob([c],{type:"text/csv;charset=utf-8;"}),m=document.createElement("a");m.href=URL.createObjectURL(d),m.setAttribute("download",`${e}_data.csv`),document.body.appendChild(m),m.click(),document.body.removeChild(m)};var M=a(5263),y=a(2102),A=a(6529);const D=()=>{const{users:e}=(0,w.KC)(),[t,a]=(0,s.useState)(!0),[v,N]=(0,s.useState)(!1),[D,k]=(0,s.useState)([]),[C,I]=(0,s.useState)([]),[T,Y]=(0,s.useState)(["Sensor 1","Sensor 2"]),[_,L]=(0,s.useState)([]),[F,H]=(0,s.useState)(null),[O,W]=(0,s.useState)(null),[$,E]=(0,s.useState)(!1);(0,s.useEffect)((()=>{if(!C)return;let e;if(C.length>0){0===_.length&&L(T),a(!0);const t=(0,l.P)((0,l.rJ)(r.db,"lactate_data"),(0,l._M)("user_name","in",C.slice(0,10)));e=(0,l.aQ)(t,(e=>{let t=[];e.forEach((e=>{const a=e.data();"number"===typeof a.timestamp&&(a.timestamp=new Date(1e3*a.timestamp).toISOString()),t.push(a)})),t=t.filter((e=>_.includes(e.sensor_id))),t.sort(((e,t)=>new Date(e.timestamp)-new Date(t.timestamp))),k(t),N(!1),a(!1)}),(e=>{console.error("Error fetching filtered data:",e),N(!0),a(!1)}))}return a(!1),()=>{e&&e()}}),[C,_]);const U=e=>{const t=new Date(e).getTime(),a=F?F.toDate().getTime():null,s=O?O.toDate().getTime():null;return(!a||t>=a)&&(!s||t<=s)},z=(e,t)=>D.filter((t=>t.sensor_id===e&&U(t.timestamp))).map((e=>e[t])),B=e=>D.filter((t=>t.sensor_id===e&&U(t.timestamp))).map((e=>new Date(e.timestamp)));return(0,i.jsxs)(i.Fragment,{children:[(0,i.jsx)("div",{className:"py-8 flex flex-col space-y-2 md:items-baseline md:flex-row md:justify-between",children:(0,i.jsx)("h1",{className:"text-2xl md:text-3xl font-bold",children:"Sensor Data Charts"})}),(0,i.jsxs)(c.A,{className:"w-full flex items-center justify-between mb-4 flex-wrap gap-4",children:[(0,i.jsxs)("div",{className:"flex gap-4 flex-wrap",children:[(0,i.jsxs)(d.A,{sx:{minWidth:250},children:[(0,i.jsx)(m.A,{children:"User Name"}),(0,i.jsx)(x.A,{value:C,onChange:e=>I([e.target.value]),input:(0,i.jsx)(h.A,{label:"User Name"}),renderValue:e=>e.join(", "),children:e.map((e=>(0,i.jsx)(u.A,{value:e,children:(0,i.jsx)(f.A,{primary:e})},e)))})]}),C.length>0&&(0,i.jsxs)(d.A,{sx:{minWidth:250},children:[(0,i.jsx)(m.A,{children:"Sensor ID"}),(0,i.jsx)(x.A,{multiple:!0,value:_,onChange:e=>L(e.target.value),input:(0,i.jsx)(h.A,{label:"Sensor ID"}),renderValue:e=>e.join(", "),children:T.map((e=>(0,i.jsxs)(u.A,{value:e,children:[(0,i.jsx)(p.A,{checked:_.includes(e)}),(0,i.jsx)(f.A,{primary:e})]},e)))})]}),_.length>0&&(0,i.jsx)(d.A,{sx:{minWidth:250},children:(0,i.jsxs)("div",{className:"flex",children:[(0,i.jsx)(y.K,{label:"Start Time",value:F,onChange:e=>H(e),slotProps:{textField:{size:"medium",sx:{minWidth:180}}}}),(0,i.jsx)(y.K,{label:"End Time",value:O,onChange:e=>W(e),slotProps:{textField:{size:"medium",sx:{minWidth:180,ml:2}}}})]})}),_.length>0&&(0,i.jsx)(b.A,{control:(0,i.jsx)(p.A,{checked:$,onChange:e=>E(e.target.checked),size:"small"}),label:"Combine graphs",sx:{ml:2,mt:1}})]}),(0,i.jsx)("button",{onClick:()=>{S("combined_sensor_data",D,F,O)},className:"text-sm bg-blue-600 hover:bg-blue-700 text-white px-4 py-2 rounded-md",children:"Download User Data"})]}),t?(0,i.jsx)(o,{children:(0,i.jsx)(n.k,{size:"40px",className:"h-[223px]"})}):v?(0,i.jsx)(o,{children:(0,i.jsx)("p",{className:"text-red-500",children:"Failed to load data."})}):0===C.length||0===_.length?(0,i.jsx)(o,{children:(0,i.jsx)("p",{className:"text-black text-lg pb-10",children:"\ud83d\udc4b Select a user to view sensor data."})}):(0,i.jsx)(o,{children:_.map((e=>{var t,a,l;const r=D.filter((t=>t.sensor_id===e)).at(-1),n=D.filter((t=>t.sensor_id===e));return(0,i.jsxs)(s.Fragment,{children:[(0,i.jsxs)("div",{className:"mt-10 mb-4",children:[(0,i.jsxs)("div",{className:"flex justify-between",children:[(0,i.jsx)("h1",{className:"text-2xl font-bold text-Black-400 pb-4",children:e}),(0,i.jsx)(A.A,{title:`Download data for ${e}`,children:(0,i.jsx)("span",{children:(0,i.jsx)(M.WCW,{className:"cursor-pointer",onClick:()=>S(e,n,F,O)})})})]}),r&&(0,i.jsxs)("div",{className:"grid grid-cols-3 gap-4 text-gray-700 pb-2 border-b",children:[(0,i.jsxs)("p",{children:["Temperature:",(0,i.jsx)("b",{className:"pl-2",children:r.temperature})]}),(0,i.jsxs)("p",{children:["Connection Status:",(0,i.jsx)("b",{className:"pl-2",children:`${r.connection_status_flag}`})]}),(0,i.jsxs)("p",{children:["Wear Status:",(0,i.jsx)("b",{className:"pl-2",children:`${r.wearing_status_flag}`})]})]})]}),!$&&(0,i.jsxs)("div",{children:[(0,i.jsx)("div",{className:"w-full overflow-x-auto",children:(0,i.jsx)("div",{className:"min-w-[800px]",children:(0,i.jsx)(j.b,{margin:{left:0,top:20,right:20,bottom:30},height:300,series:[{data:z(e,"ohm1"),label:"Lactate",showMark:!1}],xAxis:[{scaleType:"time",data:B(e)}],tooltip:{valueFormatter:(t,a)=>`Time: ${g()(void 0!==a.dataIndex?B(e)[a.dataIndex]:"").format("YYYY-MM-DD HH:mm:ss")}`}})})}),(0,i.jsxs)("h3",{className:"text-lg text-black mt-8 pb-4 text-center",children:[(0,i.jsx)("b",{children:"Lactate (Channel 1)"})," : ",(0,i.jsx)("b",{className:"pb-4 text-green-600",children:null!==(t=null===r||void 0===r?void 0:r.ohm1)&&void 0!==t?t:""})]}),(0,i.jsx)("hr",{className:"border-t border-gray-300 my-8 w-full"}),(0,i.jsx)("div",{className:"w-full overflow-x-auto",children:(0,i.jsx)("div",{className:"min-w-[800px]",children:(0,i.jsx)(j.b,{margin:{left:0,top:20,right:20,bottom:30},height:300,series:[{data:z(e,"ohm3"),label:"Lactate",showMark:!1}],xAxis:[{scaleType:"time",data:B(e)}],tooltip:{valueFormatter:(t,a)=>`Time: ${g()(void 0!==a.dataIndex?B(e)[a.dataIndex]:"").format("YYYY-MM-DD HH:mm:ss")}`}})})}),(0,i.jsxs)("h3",{className:"text-lg text-black mt-8 pb-4 text-center",children:[(0,i.jsx)("b",{children:"Lactate (Channel 2)"})," : ",(0,i.jsx)("b",{className:"pb-4 text-green-600",children:null!==(a=null===r||void 0===r?void 0:r.ohm1)&&void 0!==a?a:""})]}),(0,i.jsx)("hr",{className:"border-t border-gray-300 my-8 w-full"}),(0,i.jsx)("div",{className:"w-full overflow-x-auto",children:(0,i.jsx)("div",{className:"min-w-[800px]",children:(0,i.jsx)(j.b,{margin:{left:0,top:20,right:20,bottom:30},height:300,series:[{data:z(e,"ohm3"),label:"Lactate",showMark:!1}],xAxis:[{scaleType:"time",data:B(e)}],tooltip:{valueFormatter:(t,a)=>`Time: ${g()(void 0!==a.dataIndex?B(e)[a.dataIndex]:"").format("YYYY-MM-DD HH:mm:ss")}`}})})}),(0,i.jsxs)("h3",{className:"text-lg text-black mt-8 pb-4 text-center",children:[(0,i.jsx)("b",{children:"Lactate (Channel 3)"})," : ",(0,i.jsx)("b",{className:"pb-4 text-green-600",children:null!==(l=null===r||void 0===r?void 0:r.ohm1)&&void 0!==l?l:""})]})]}),$&&(0,i.jsx)("div",{className:"w-full overflow-x-auto",children:(0,i.jsx)("div",{className:"min-w-[800px]",children:(0,i.jsx)(j.b,{margin:{left:0,top:20,right:20,bottom:30},height:350,xAxis:[{scaleType:"time",data:B(e)}],series:[{data:z(e,"ohm1"),label:"Lactate - Channel 1",showMark:!1},{data:z(e,"ohm2"),label:"Lactate - Channel 2",showMark:!1},{data:z(e,"ohm3"),label:"Lactate - Channel 3",showMark:!1}],tooltip:{valueFormatter:(t,a)=>`Time: ${g()(void 0!==a.dataIndex?B(e)[a.dataIndex]:"").format("YYYY-MM-DD HH:mm:ss")}`}})})})]},e)}))})]})}}}]);
//# sourceMappingURL=689.26750403.chunk.js.map